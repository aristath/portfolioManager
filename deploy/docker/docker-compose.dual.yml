# Docker Compose for Dual-Device Deployment
# This file is for documentation/testing - actual dual-device deployment
# uses separate docker-compose instances on each device

version: '3.8'

# Device 1 Services (Compute Engine)
services:
  planning:
    build:
      context: ../..
      dockerfile: services/planning/Dockerfile
    ports:
      - "50051:50051"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  scoring:
    build:
      context: ../..
      dockerfile: services/scoring/Dockerfile
    ports:
      - "50052:50052"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  optimization:
    build:
      context: ../..
      dockerfile: services/optimization/Dockerfile
    ports:
      - "50053:50053"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  # Planning Microservices (HTTP-only, FastAPI)
  opportunity:
    build:
      context: ../..
      dockerfile: services/opportunity/Dockerfile
    ports:
      - "8008:8008"
    volumes:
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  generator:
    build:
      context: ../..
      dockerfile: services/generator/Dockerfile
    ports:
      - "8009:8009"
    volumes:
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  evaluator-1:
    build:
      context: ../..
      dockerfile: services/evaluator/Dockerfile
    ports:
      - "8010:8010"
    volumes:
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
      - EVALUATOR_PORT=8010
    restart: unless-stopped

  evaluator-2:
    build:
      context: ../..
      dockerfile: services/evaluator/Dockerfile
    ports:
      - "8020:8020"
    volumes:
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
      - EVALUATOR_PORT=8020
    restart: unless-stopped

  evaluator-3:
    build:
      context: ../..
      dockerfile: services/evaluator/Dockerfile
    ports:
      - "8030:8030"
    volumes:
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
      - EVALUATOR_PORT=8030
    restart: unless-stopped

  coordinator:
    build:
      context: ../..
      dockerfile: services/coordinator/Dockerfile
    ports:
      - "8011:8011"
    volumes:
      - ../../deploy/configs/dual-device:/app/app/config
    environment:
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped
    depends_on:
      - opportunity
      - generator
      - evaluator-1
      - evaluator-2
      - evaluator-3

# Note: For actual dual-device deployment, run these services on Device 2:
# - portfolio (port 50054)
# - trading (port 50055)
# - universe (port 50056)
# - gateway (ports 8000, 50057)
