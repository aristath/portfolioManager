# Docker Compose for Load-Balanced Deployment
# Demonstrates custom service distribution

version: '3.8'

services:
  # Device 1: Planning, Scoring, Universe
  planning:
    build:
      context: ../..
      dockerfile: services/planning/Dockerfile
    ports:
      - "50051:50051"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/load-balanced:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  scoring:
    build:
      context: ../..
      dockerfile: services/scoring/Dockerfile
    ports:
      - "50052:50052"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/load-balanced:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  universe:
    build:
      context: ../..
      dockerfile: services/universe/Dockerfile
    ports:
      - "50056:50056"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/load-balanced:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device1.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  # Device 2: Portfolio, Trading, Optimization, Gateway
  portfolio:
    build:
      context: ../..
      dockerfile: services/portfolio/Dockerfile
    ports:
      - "50054:50054"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/load-balanced:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device2.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  trading:
    build:
      context: ../..
      dockerfile: services/trading/Dockerfile
    ports:
      - "50055:50055"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/load-balanced:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device2.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  optimization:
    build:
      context: ../..
      dockerfile: services/optimization/Dockerfile
    ports:
      - "50053:50053"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/load-balanced:/app/app/config
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device2.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped

  gateway:
    build:
      context: ../..
      dockerfile: services/gateway/Dockerfile
    ports:
      - "8000:8000"
      - "50057:50057"
    volumes:
      - ../../data:/app/data
      - ../../deploy/configs/load-balanced:/app/app/config
      - ../../static:/app/static
    environment:
      - PYTHONPATH=/app
      - DEVICE_CONFIG_PATH=/app/app/config/device2.yaml
      - SERVICES_CONFIG_PATH=/app/app/config/services.yaml
    restart: unless-stopped
    depends_on:
      - planning
      - scoring
      - portfolio
      - trading
      - universe
      - optimization
